<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1100">
  <!-- Define gradients and styles -->
  <defs>
    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad4" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad5" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad6" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#FF6B6B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FF8E53;stop-opacity:1" />
    </linearGradient>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-white" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="white" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="800" y="40" font-family="Arial, sans-serif" font-size="32" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    ðŸŽ¨ RL Painter: Model Architecture &amp; Training Pipeline
  </text>
  
  <!-- STATE INPUT -->
  <rect x="50" y="80" width="250" height="200" rx="8" fill="url(#grad1)" stroke="#5a67d8" stroke-width="3"/>
  <text x="175" y="110" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    State Input
  </text>
  <text x="175" y="135" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="white">
    Shape: [64, 64, 6]
  </text>
  
  <rect x="70" y="150" width="210" height="115" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="2"/>
  <text x="175" y="172" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Channel 0-2: Canvas RGB
  </text>
  <text x="175" y="190" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Channel 3: Cursor Position
  </text>
  <text x="175" y="208" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Channel 4: Outline Coverage
  </text>
  <text x="175" y="226" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Channel 5: Interior Coverage
  </text>
  <text x="175" y="250" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white" font-style="italic">
    Float32, normalized [0,1]
  </text>
  
  <!-- Arrow to CNN -->
  <line x1="300" y1="180" x2="360" y2="180" stroke="#333" stroke-width="4" marker-end="url(#arrowhead)"/>
  
  <!-- CNN ENCODER -->
  <rect x="370" y="80" width="550" height="500" rx="10" fill="#f8f9fa" stroke="#495057" stroke-width="3"/>
  <text x="645" y="110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    ðŸ§  Policy Network (CNN)
  </text>
  
  <!-- Conv Block 1 -->
  <rect x="400" y="130" width="490" height="90" rx="8" fill="url(#grad2)" stroke="#e91e63" stroke-width="2"/>
  <text x="645" y="155" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Conv2D Block 1
  </text>
  <text x="645" y="178" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    Conv2D(6â†’48, kernel=3, stride=2, padding=1) + ReLU + BatchNorm2d
  </text>
  <text x="645" y="198" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white" font-style="italic">
    Output: [48, 32, 32]
  </text>
  
  <!-- Arrow -->
  <line x1="645" y1="220" x2="645" y2="240" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Conv Block 2 -->
  <rect x="400" y="245" width="490" height="90" rx="8" fill="url(#grad3)" stroke="#2196f3" stroke-width="2"/>
  <text x="645" y="270" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Conv2D Block 2
  </text>
  <text x="645" y="293" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    Conv2D(48â†’96, kernel=3, stride=2, padding=1) + ReLU + BatchNorm2d
  </text>
  <text x="645" y="313" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white" font-style="italic">
    Output: [96, 16, 16]
  </text>
  
  <!-- Arrow -->
  <line x1="645" y1="335" x2="645" y2="355" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Conv Block 3 -->
  <rect x="400" y="360" width="490" height="90" rx="8" fill="url(#grad4)" stroke="#10b981" stroke-width="2"/>
  <text x="645" y="385" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Conv2D Block 3
  </text>
  <text x="645" y="408" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    Conv2D(96â†’192, kernel=3, stride=2, padding=1) + ReLU + BatchNorm2d
  </text>
  <text x="645" y="428" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white" font-style="italic">
    Output: [192, 8, 8]
  </text>
  
  <!-- Arrow -->
  <line x1="645" y1="450" x2="645" y2="470" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Flatten -->
  <rect x="520" y="475" width="250" height="60" rx="8" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2"/>
  <text x="645" y="500" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2d3436">
    Flatten Layer
  </text>
  <text x="645" y="520" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2d3436">
    Output: [12288] (192Ã—8Ã—8)
  </text>
  
  <!-- Arrow split to two heads -->
  <line x1="645" y1="535" x2="645" y2="600" stroke="#333" stroke-width="3"/>
  <line x1="380" y1="600" x2="645" y2="600" stroke="#333" stroke-width="3"/>
  <line x1="645" y1="600" x2="910" y2="600" stroke="#333" stroke-width="3"/>
  <line x1="380" y1="600" x2="380" y2="620" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="910" y1="600" x2="910" y2="620" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- ACTION HEAD -->
  <rect x="200" y="625" width="360" height="220" rx="8" fill="url(#grad5)" stroke="#f59e0b" stroke-width="3"/>
  <text x="380" y="655" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Action Head
  </text>
  
  <rect x="220" y="670" width="320" height="40" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="380" y="695" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    FC(12288 â†’ 512) + ReLU + Dropout(0.2)
  </text>
  
  <line x1="380" y1="710" x2="380" y2="720" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="220" y="720" width="320" height="40" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="380" y="745" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    FC(512 â†’ 256) + ReLU + Dropout(0.1)
  </text>
  
  <line x1="380" y1="760" x2="380" y2="770" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="220" y="770" width="320" height="40" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="380" y="795" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    FC(256 â†’ 401) [Grid 20Ã—20 + STOP]
  </text>
  
  <text x="380" y="828" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white" font-weight="bold">
    Output: Action Logits [401]
  </text>
  
  <!-- VALUE HEAD -->
  <rect x="730" y="625" width="360" height="220" rx="8" fill="url(#grad6)" stroke="#dc2626" stroke-width="3"/>
  <text x="910" y="655" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Value Head
  </text>
  
  <rect x="750" y="690" width="320" height="40" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="910" y="715" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    FC(12288 â†’ 256) + ReLU
  </text>
  
  <line x1="910" y1="730" x2="910" y2="740" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="750" y="740" width="320" height="40" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="910" y="765" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    FC(256 â†’ 1)
  </text>
  
  <text x="910" y="808" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white" font-weight="bold">
    Output: State Value V(s)
  </text>
  
  <!-- PHASE 1: BEHAVIORAL CLONING -->
  <rect x="1130" y="80" width="420" height="380" rx="10" fill="#fff5f5" stroke="#fc8181" stroke-width="3"/>
  <text x="1340" y="115" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#c53030">
    PHASE 1: Behavioral Cloning
  </text>
  
  <rect x="1160" y="135" width="360" height="90" rx="8" fill="#fed7d7" stroke="#fc8181" stroke-width="2"/>
  <text x="1340" y="160" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#742a2a">
    Expert Demonstrations
  </text>
  <text x="1340" y="180" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#742a2a">
    Dense trajectories: 140-180 points
  </text>
  <text x="1340" y="198" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#742a2a">
    State-Action pairs: (s_t, a_t)
  </text>
  <text x="1340" y="216" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#742a2a">
    80-120 demonstrations per shape
  </text>
  
  <line x1="1340" y1="225" x2="1340" y2="245" stroke="#c53030" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <rect x="1160" y="250" width="360" height="90" rx="8" fill="#c6f6d5" stroke="#48bb78" stroke-width="2"/>
  <text x="1340" y="275" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#22543d">
    Supervised Learning
  </text>
  <text x="1340" y="295" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#22543d">
    Loss = CrossEntropy(Ï€(a|s), a_expert)
  </text>
  <text x="1340" y="313" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#22543d">
    Optimizer: Adam (lr=1e-3)
  </text>
  <text x="1340" y="331" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#22543d">
    Epochs: 80-120, Batch: 64
  </text>
  
  <line x1="1340" y1="340" x2="1340" y2="360" stroke="#c53030" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <rect x="1160" y="365" width="360" height="80" rx="8" fill="#bee3f8" stroke="#3182ce" stroke-width="2"/>
  <text x="1340" y="390" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#1e4e8c">
    Pre-trained Policy
  </text>
  <text x="1340" y="410" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e4e8c">
    âœ“ Learns expert behavior
  </text>
  <text x="1340" y="428" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e4e8c">
    âœ“ Good initialization for RL
  </text>
  
  <!-- Arrow from BC to RL -->
  <line x1="1340" y1="460" x2="1340" y2="485" stroke="#333" stroke-width="4" marker-end="url(#arrowhead)"/>
  <text x="1340" y="477" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">
    Transfer weights â†“
  </text>
  
  <!-- PHASE 2: RL TRAINING LOOP -->
  <rect x="50" y="890" width="1500" height="180" rx="10" fill="#f0fff4" stroke="#48bb78" stroke-width="3"/>
  <text x="800" y="925" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#2f855a">
    PHASE 2: Reinforcement Learning (Policy Gradient - REINFORCE)
  </text>
  
  <!-- RL Loop Components -->
  <rect x="80" y="945" width="280" height="105" rx="8" fill="url(#grad3)" stroke="#2196f3" stroke-width="2"/>
  <text x="220" y="970" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    1. Sample Action
  </text>
  <text x="220" y="992" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    a_t ~ Categorical(Ï€(Â·|s_t))
  </text>
  <text x="220" y="1010" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Stochastic policy
  </text>
  <text x="220" y="1028" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Store: s_t, a_t, log Ï€(a_t|s_t)
  </text>
  
  <line x1="360" y1="997" x2="400" y2="997" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <rect x="410" y="945" width="280" height="105" rx="8" fill="url(#grad4)" stroke="#10b981" stroke-width="2"/>
  <text x="550" y="970" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    2. Environment Step
  </text>
  <text x="550" y="992" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    s_{t+1} = env.step(a_t)
  </text>
  <text x="550" y="1010" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Draw stroke on canvas
  </text>
  <text x="550" y="1028" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Update cursor position
  </text>
  
  <line x1="690" y1="997" x2="730" y2="997" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <rect x="740" y="945" width="280" height="105" rx="8" fill="url(#grad5)" stroke="#f59e0b" stroke-width="2"/>
  <text x="880" y="970" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    3. Compute Reward
  </text>
  <text x="880" y="988" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    r_t = Î”_outline Ã— w_o + Î”_interior Ã— w_i
  </text>
  <text x="880" y="1004" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    + phase_bonus + completion
  </text>
  <text x="880" y="1020" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    w_o: 300-450, w_i: 200-250
  </text>
  <text x="880" y="1036" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    Store: r_t
  </text>
  
  <line x1="1020" y1="997" x2="1060" y2="997" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <rect x="1070" y="945" width="280" height="105" rx="8" fill="url(#grad6)" stroke="#dc2626" stroke-width="2"/>
  <text x="1210" y="970" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    4. Policy Update
  </text>
  <text x="1210" y="988" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    G_t = Î£ Î³^k r_{t+k} (returns)
  </text>
  <text x="1210" y="1004" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    A_t = G_t - V(s_t) (advantage)
  </text>
  <text x="1210" y="1020" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    L = -log Ï€(a_t|s_t) Ã— A_t
  </text>
  <text x="1210" y="1036" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    Update Î¸ via backprop
  </text>
  
  <!-- Loop back arrow -->
  <line x1="1350" y1="997" x2="1430" y2="997" stroke="#333" stroke-width="3"/>
  <line x1="1430" y1="997" x2="1430" y2="860" stroke="#333" stroke-width="3"/>
  <line x1="1430" y1="860" x2="220" y2="860" stroke="#333" stroke-width="3"/>
  <line x1="220" y1="860" x2="220" y2="945" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="1470" y="930" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="start" fill="#333">
    Repeat 800-1200 episodes
  </text>
</svg>